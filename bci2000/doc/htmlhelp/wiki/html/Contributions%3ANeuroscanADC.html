<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
        "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en" >
<head>
<title>Contributions:NeuroscanADC - BCI2000 Help</title>
<meta http-equiv="Content-type" content="text/html; charset=utf-8" />
<meta name="keywords" content="Contributions:NeuroscanADC,Contributions:ADCs,User Reference:Filters" />
<link rel="shortcut icon" href="../../favicon.ico" />
<link rel='stylesheet' type='text/css' media='print' href='../skins/common/wikiprintable.css' />
<link rel="stylesheet" href="../skins/common/wikistandard.css@1" type="text/css" />
<link rel="stylesheet" href="../skins/common/common.css" type="text/css" />
<link rel="stylesheet" href="../skins/common/htmlhelp.css" type="text/css" />

<style type='text/css'>
a.new, #quickbar a.new { color: #CC2200; }
.editsection { display: none; }
#quickbar { position: absolute; top: 4px; left: 4px;  }
#article { margin-left: 152px; margin-right: 4px; }
</style>
</head>

<body bgcolor='#FFFFFF'>

<div id='content'>
<div id='topbar'>
<table border='0' cellspacing='0' width='98%'>
<tr>
</tr>
</table>
</div>

<div id='article'>
<h1 class="pagetitle">NeuroscanADC</h1><p class="subtitle">Contributions</p><hr class="sep" /><table id="toc" class="toc" summary="Contents"><tr><td><div id="toctitle"><h2>Contents</h2></div>
<ul>
<li class='toclevel-1'><a href="Contributions%253ANeuroscanADC.html#Synopsis"><span class="tocnumber">1</span> <span class="toctext">Synopsis</span></a></li>
<li class='toclevel-1'><a href="Contributions%253ANeuroscanADC.html#Location"><span class="tocnumber">2</span> <span class="toctext">Location</span></a></li>
<li class='toclevel-1'><a href="Contributions%253ANeuroscanADC.html#Versioning"><span class="tocnumber">3</span> <span class="toctext">Versioning</span></a>
<ul>
<li class='toclevel-2'><a href="Contributions%253ANeuroscanADC.html#Author"><span class="tocnumber">3.1</span> <span class="toctext">Author</span></a></li>
<li class='toclevel-2'><a href="Contributions%253ANeuroscanADC.html#Version_History"><span class="tocnumber">3.2</span> <span class="toctext">Version History</span></a></li>
<li class='toclevel-2'><a href="Contributions%253ANeuroscanADC.html#Source_Code_Revisions"><span class="tocnumber">3.3</span> <span class="toctext">Source Code Revisions</span></a></li>
</ul>
</li>
<li class='toclevel-1'><a href="Contributions%253ANeuroscanADC.html#Functional_Description"><span class="tocnumber">4</span> <span class="toctext">Functional Description</span></a>
<ul>
<li class='toclevel-2'><a href="Contributions%253ANeuroscanADC.html#Neuroscan_Source_Module"><span class="tocnumber">4.1</span> <span class="toctext">Neuroscan Source Module</span></a></li>
<li class='toclevel-2'><a href="Contributions%253ANeuroscanADC.html#Undocumented_Communication"><span class="tocnumber">4.2</span> <span class="toctext">Undocumented Communication</span></a>
<ul>
<li class='toclevel-3'><a href="Contributions%253ANeuroscanADC.html#Request_Basic_Information"><span class="tocnumber">4.2.1</span> <span class="toctext">Request Basic Information</span></a></li>
<li class='toclevel-3'><a href="Contributions%253ANeuroscanADC.html#Receive_16-bit_Data_Packet"><span class="tocnumber">4.2.2</span> <span class="toctext">Receive 16-bit Data Packet</span></a></li>
</ul>
</li>
</ul>
</li>
<li class='toclevel-1'><a href="Contributions%253ANeuroscanADC.html#Parameters"><span class="tocnumber">5</span> <span class="toctext">Parameters</span></a>
<ul>
<li class='toclevel-2'><a href="Contributions%253ANeuroscanADC.html#ServerAddress"><span class="tocnumber">5.1</span> <span class="toctext">ServerAddress</span></a></li>
</ul>
</li>
<li class='toclevel-1'><a href="Contributions%253ANeuroscanADC.html#States"><span class="tocnumber">6</span> <span class="toctext">States</span></a>
<ul>
<li class='toclevel-2'><a href="Contributions%253ANeuroscanADC.html#NeuroscanEvent1"><span class="tocnumber">6.1</span> <span class="toctext">NeuroscanEvent1</span></a></li>
</ul>
</li>
<li class='toclevel-1'><a href="Contributions%253ANeuroscanADC.html#The_neurogetparams_Command_Line_Tool"><span class="tocnumber">7</span> <span class="toctext">The neurogetparams Command Line Tool</span></a></li>
<li class='toclevel-1'><a href="Contributions%253ANeuroscanADC.html#See_also"><span class="tocnumber">8</span> <span class="toctext">See also</span></a></li>
</ul>
</td></tr></table>
<a name="Synopsis"></a><h2>Synopsis</h2>
<p>The <i>NeuroscanADC</i> component implements the client side of the TCP/IP-based Neuroscan Acquire protocol. Thus, it may be used to interface BCI2000 with Neuroscan EEG systems.
</p>
<a name="Location"></a><h2>Location</h2>
<p><a href="http://www.bci2000.org/svn/trunk/src/contrib/SignalSource/Neuroscan" class='external free' title="http://www.bci2000.org/svn/trunk/src/contrib/SignalSource/Neuroscan" rel="nofollow">http://www.bci2000.org/svn/trunk/src/contrib/SignalSource/Neuroscan</a>
</p>
<a name="Versioning"></a><h2>Versioning</h2>
<a name="Author"></a><h3>Author</h3>
<p>Gerwin Schalk, (c) 2004 Wadsworth Center, New York State Department of Health.
</p>
<a name="Version_History"></a><h3>Version History</h3>
<ul><li> V1.00 - 04/28/2004 - First working version
</li><li> V1.10 - 05/17/2004 - Now includes support for 32bit data
</li></ul>
<a name="Source_Code_Revisions"></a><h3>Source Code Revisions</h3>
<ul><li>Initial development: 268
</li><li>Tested under: 1110
</li><li>Known to compile under: 1528
</li><li>Broken since: --
</li></ul>
<a name="Functional_Description"></a><h2>Functional Description</h2>
<p><b>NuAmps/SynAmps</b> are EEG recording systems from Neuroscan, Inc., that are 
widely used in clinical settings. The increasing use of BCI2000 in those 
environments created the need for Neuroscan support in BCI2000. This document 
describes this support that consists of two components: A BCI2000-compatible 
Source Module (<tt>Neuroscan.exe</tt>) and a command-line tool 
(<tt>neurogetparams</tt>). These components are described below and have been 
tested with <b>Neuroscan Acquire</b> version 4.3.1.
</p>
<a name="Neuroscan_Source_Module"></a><h3>Neuroscan Source Module</h3>
<p>The BCI2000-compatible Source Module <tt>Neuroscan.exe</tt> can be used instead 
of any other source module. In addition to standard parameters (i.e. 
<i>SampleBlockSize,</i> <i>SamplingRate,</i> <i>SourceCh</i>), it only 
requests one Neuroscan-specific parameter <i>(ServerAddress)</i> that defines 
the IP address (or host name) and the port number of the <i>Acquire</i> server. 
An example for an appropriate definition is <tt>localhost:3999</tt>. Before 
starting BCI2000, you need to start <b>Acquire,</b> click on the <b>S</b> symbol 
in the top right corner (to enable the server) and start the server on any port. 
Please note that by default, <b>Acquire</b> suggests port 4000, which is a port 
used by BCI2000. You might use port 3999 instead. Once the server is running, 
you can start BCI2000. It is imperative that certain parameters (e.g., the 
number of channels) in BCI2000 match the settings in <b>Acquire.</b> You can 
read these settings from <b>Acquire</b> using the command line tool described in 
the following section. This command line tool can create a parameter file 
fragment that needs to be loaded on top of an existing parameter file every time 
a setting in <b>Acquire</b> is changed.
</p>
<a name="Undocumented_Communication"></a><h3>Undocumented Communication</h3>
<p><b>Neuroscan Acquire</b> supports communication options that are not documented 
in the <tt>NetAcquire.doc</tt> document. BCI2000 needs to use two of them, the 
request for basic Neuroscan configuration information (which will return 
information such as the number of channels and the sampling rate) and the 
receipt of packets of data, to function properly. They are listed below:
</p>
<table border="1">
<tr>
<th> Packet ID </th><th> Code </th><th> Request </th><th> Body Size
</th></tr>
<tr>
<td> "CTRL" </td><td> 3 (Client Ctrl Code) </td><td> 5 (Req Basic Info) </td><td> 0
</td></tr>
<tr>
<td> "DATA" </td><td> 1 (Datatype Info)    </td><td> 3 (InfoType BasicInfo) </td><td> bodyLen
</td></tr>
<tr>
<td> "DATA" </td><td> 2 (EEG Data)         </td><td> 1 (Raw 16-bit) </td><td> bodyLen
</td></tr></table>
<a name="Request_Basic_Information"></a><h4>Request Basic Information</h4>
<p>The client sends a request for basic information ("CTRL", Client Ctrl Code, Req 
Basic Info). The server responds by sending a data block ("DATA", Datatype Info, 
InfoType BasicInfo) that contains a data structure describing the current 
configuration of data acquisition in Acquire. This data structure is as follows:
</p>
<pre>
struct AcqBasicInfo
 {
 DWORD dwSize;      // Size of structure, used for version control
 int   nEegChan;    // Number of EEG channels
 int   nEvtChan;    // Number of event channels
 int   nBlockPnts;  // Samples in block
 int   nRate;       // Sampling rate (in Hz)
 int   nDataSize;   // 2 for &quot;short&quot;, 4 for &quot;int&quot; type of data
 float fResolution; // Resolution for LSB
 };
</pre>
<p>The first element, dwSize, can and should be cross checked with the length of 
the structure <b>AcqBasicInfo</b> and must match.
</p>
<a name="Receive_16-bit_Data_Packet"></a><h4>Receive 16-bit Data Packet</h4>
<p>The client may send a <b>Request to Start Sending Data</b> to the Acquire server 
(as described in the <tt>NetAcquire.doc</tt> document). This will prompt the 
server to start sending blocks of raw signal values. In order to interpret these 
signal values, the client must first have sent a <b>Request for Basic Information,</b> as described above. The incoming data packets ("DATA", EEG Data, 
Raw 16-bit) can then be interpreted using this information and the code below.
</p>
<pre>
// make sure the body has the right length
assert((int)(pMsg-&gt;m_dwSize) == 
              (int)(m_BasicInfo.nEegChan+m_BasicInfo.nEvtChan)
              *m_BasicInfo.nBlockPnts*m_BasicInfo.nDataSize);
// process raw 16 bit data
for (int samp=0; samp&lt;m_BasicInfo.nBlockPnts; samp++)
 {
 for (int ch=0; ch&lt;m_BasicInfo.nEegChan+m_BasicInfo.nEvtChan; ch++)
  {
  short *sample=(short *)pMsg-&gt;m_pBody;
  printf(&quot;%d &quot;, sample[samp*(m_BasicInfo.nEegChan+m_BasicInfo.nEvtChan)+ch]);
  }
 }
</pre>
<a name="Parameters"></a><h2>Parameters</h2>
<a name="ServerAddress"></a><h3>ServerAddress</h3>
<p>Address and port of the Neuroscan Acquire server, given in <tt>address:port</tt> format.
</p>
<a name="States"></a><h2>States</h2>
<a name="NeuroscanEvent1"></a><h3>NeuroscanEvent1</h3>
<p>An 8-bit state that encodes event information as sent over the Neuroscan Acquire protocol.
</p>
<a name="The_neurogetparams_Command_Line_Tool"></a><h2>The <tt>neurogetparams</tt> Command Line Tool</h2>
<p>This command line tool reads system settings from the <b>Neuroscan Acquire</b>
server, displays them on a screen and creates a BCI2000 parameter file fragment 
if desired. It can be used as follows: <tt>neurogetparams -address 
localhost:3999 -paramfile test.prm</tt>. (The <b>Acquire</b> server has to be 
enabled before using this tool.) Once BCI2000 is configured correctly, this 
parameter file fragment needs to be loaded on top of the existing configuration 
to make sure that the settings match. You only need to repeat this procedure if 
you change settings in <b>Acquire</b> (e.g., such as the number of channels or 
the amplification).
</p>
<pre>
BCI2000 Parameter Tool for Neuroscan Acquire V4.3
*******************************************************************
(C)2004 Gerwin Schalk and Juergen Mellinger
        Wadsworth Center, New York State Dept of Health, Albany, NY
        Eberhardt-Karls University of Tuebingen, Germany
*******************************************************************
Signal Channels: 32
Event Channels:  1
Block Size:      40
Sampling Rate:   1000
Bits/Sample:     16
Resolution:      0.168uV/LSB
Parameter file test.prm successfully written
</pre>
<a name="See_also"></a><h2>See also</h2>
<p><a href="User_Reference%253AFilters.html" title="User Reference:Filters">User Reference:Filters</a>, <a href="Contributions%253AADCs.html" title="Contributions:ADCs">Contributions:ADCs</a>
</p>
<div class="printfooter">
</div>

</div><br style="clear:both" />

<div id='footer'><table border="0" cellspacing="0"><tr><td width='152' rowspan='1'>&nbsp;</td><td class='bottom' align='left' valign='top'></td></tr></table>
</div>
</div>

<div id='quickbar'>
<table class="image"><caption align="bottom"><h2>BCI2000 Help</h2></caption><tr><td><a href="BCI2000_Help.html"><img src='../../images/bci2000logo_small.png' height=100 width=100 alt='[BCI2000 Help]' /></a></td></tr></table>
<hr class='sep' /><a href="User_Reference%253AContents.html">User Manual</a><br />
<a href="Technical_Reference%253AContents.html">Technical Reference</a><br />
<a href="Contributions%253AContents.html">Contributions</a><br />
<ul><li><a href="Contributions%253AADCs.html">Data Acquisition</a></li>
<li><a href="Contributions%253AFileWriters.html">File Formats</a></li>
<li><a href="Contributions%253ASignalProcessing.html">Signal Processing</a></li>
<li><a href="Contributions%253AApplications.html">Applications</a></li>
<li><a href="Contributions%253ATools.html">Tools</a></li>
</ul><a href="Programming_Reference%253AContents.html">Programming Manual</a><br />
<hr class='sep' />
<a href="BCI2000_Glossary.html">BCI2000 Glossary</a><br />
</div>

</body></html>